# Privacy Policy & Data Handling

## Overview

The Decenza Shot Map is designed with privacy as a core principle. We collect only the minimum data necessary to display espresso shots on a world map.

## Data Collection

### What We Collect

| Data | Purpose | Retention |
|------|---------|-----------|
| City name | Display location on map | 180 days (raw), forever (aggregates) |
| Country code | Improve city resolution, filtering | 180 days (raw), forever (aggregates) |
| Espresso profile name | Statistics and trends | 180 days (raw), forever (aggregates) |
| Software name & version | Statistics, debugging | 180 days (raw), forever (aggregates) |
| Machine model | Statistics and trends | 180 days (raw), forever (aggregates) |
| Timestamp | Ordering events | 180 days (raw), forever (aggregates) |

### What We Do NOT Collect

- **IP addresses**: Not stored in any database
- **Device identifiers**: No permanent machine IDs
- **User accounts**: No registration required
- **Precise location**: Only city-level (not GPS coordinates)
- **Personal information**: No names, emails, or identifiers

## Data Storage

### Raw Events (ShotsRaw)

Individual shot events stored with automatic deletion after 180 days (configurable):

```
{
  city: "Copenhagen",
  country_code: "DK",
  lat: 55.7,        // City centroid, not precise
  lon: 12.6,
  profile: "Classic Espresso",
  software_name: "Decenza|DE1",
  software_version: "1.2.3",
  machine_model: "Decent DE1",
  ts: 1704067200000,
  ttl: <auto-delete timestamp>
}
```

### Aggregates (ShotsAgg)

Daily counts stored indefinitely for historical trends:

```
{
  pk: "DAY#2024-01-01",
  sk: "CITY#Copenhagen#CC#DK",
  count: 42
}
```

Aggregates contain no individual event data.

## City Coordinates

### How We Resolve Cities

We use a server-side lookup table (Option A) to convert city names to coordinates:

1. Client sends only city name + optional country code
2. Server looks up coordinates in Cities table
3. Returns city centroid coordinates (~city center)

This approach:
- **Protects privacy**: Client doesn't send coordinates
- **Is consistent**: Same city always shows at same location
- **Is transparent**: Coordinates are city centers, not actual locations

### Coordinate Precision

Coordinates are stored to 1 decimal place (~11km precision), representing city centers only.

## Idempotency Keys

If clients provide an idempotency_key:
- Stored for 1 hour only
- Used to prevent duplicate events
- Automatically deleted after TTL
- Not linked to any device or user

## WebSocket Connections

Connection IDs:
- Generated by AWS API Gateway
- Stored only while connected
- Automatically deleted after 2 hours (TTL)
- Not linked to any user data

## Data Access

### Who Can Access

- **Public**: Aggregated statistics only (counts by city/profile)
- **Website visitors**: Live feed shows city + profile only
- **Operators**: CloudWatch logs for debugging (no IP logging)

### No Third-Party Sharing

We do not:
- Sell data to third parties
- Share data with advertisers
- Use data for profiling
- Track users across sessions

## Data Retention

| Data Type | Retention | Deletion Method |
|-----------|-----------|-----------------|
| Raw events | 180 days | DynamoDB TTL |
| Idempotency keys | 1 hour | DynamoDB TTL |
| WebSocket connections | 2 hours | DynamoDB TTL |
| Aggregates | Indefinite | Manual |
| CloudWatch logs | 14 days | Log retention |

## User Rights

Since we don't collect personal data:
- No user accounts to delete
- No personal data to export
- No tracking to opt out of

If you have concerns, contact the project maintainers.

## Security

- All data in transit encrypted (HTTPS/WSS)
- All data at rest encrypted (AWS managed keys)
- Minimal IAM permissions (least privilege)
- No sensitive data in logs

## Changes

This privacy policy may be updated. Significant changes will be announced in the repository.

## Technical Implementation

### No IP Logging

API Gateway access logs are configured to NOT include source IP:

```json
{
  "requestId": "$context.requestId",
  "requestTime": "$context.requestTime",
  "httpMethod": "$context.httpMethod",
  "routeKey": "$context.routeKey",
  "status": "$context.status"
}
```

### Client Coordinates (Optional)

If clients send lat/lon (Option B), they are:
- Rounded to 1 decimal place (~11km)
- Used only if city lookup fails
- Not traceable to specific address

### Recommendations for Clients

When integrating with the API:

1. **Send city name only** (preferred)
2. **Include country code** for better resolution
3. **Don't send precise coordinates** unless necessary
4. **Don't include device IDs** in any field

Example minimal request:
```json
{
  "city": "Copenhagen",
  "country_code": "DK",
  "profile": "My Profile",
  "software_name": "MyApp",
  "software_version": "1.0",
  "machine_model": "My Machine"
}
```
